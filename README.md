# Telegram-bot для поиска отелей _Время путешествий!_

Данный бот позволяет проводить поиск отелей по Вашим критериям поиска. Ссылка на телеграм-бота:
https://t.me/ViktorovDV_bot

## Возможности бота

С помощью данного телеграм-бота вы можете:

- подбирать отели по самой низкой цене
- подбирать отели самого высокого класса
- искать отели с указанием более точных параметров, таких как цена за ночь, отзывы посетителей и количество звезд

---

По каждому отелю будет предоставляться следующая информация

- Название отеля
- Краткое описание отеля
- Цена за одну ночь проживания
- Цена за все время проживания
- Адрес отеля
- Оценки посетителей
- Фотографии, если необходимо
- Ссылка на бронирование

## Установка

Для запуска бота необходимо выполнить несколько шагов, описанных далее

### Шаги установки:

1. **Клонирование репозитория:**
   
   Для установки необходимо клонировать репозиторий с помощью следующей команды:
   ```bash
   git clone https://github.com/DmitriiViktorov/Hotel-Telegram-Bot
   ```

2. **Установка зависимостей**
   
   Создайте виртуальное окружение и установите зависимости:

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Для Windows используйте venv\Scripts\activate
   pip install -r requirements.txt
    ```
   
3. **Подключение бота и АПИ**:
   
   Создайте файл .env в корне проекта. В этом файле нужно будет записать следующие значения:
   
   ```plaintext
   BOT_TOKEN = "токен вашего телеграм-бота"
   RAPID_API_KEY = "ключ вашего api"
   ```
   
   Чтобы получить значение токен телеграм-бота, вам следует в приложении Telegram найти по имени аккаунт BotFather и выполнить команду /newbot.
   Выполнив все шаги создания бота, вы получите сообщение, содержащее такую строку:
   ```
   Use this token to access the HTTP API:
   <токен вашего телеграм-бота>
   Keep your token secure and store it safely, it can be used by anyone to control your bot.
   ```
   
   Это код нужно вставить в файл .env для связи приложения и вашего бота.

   RAPID_API_KEY - это ключ для АПИ сайта hotels.com на маркетплейсе Rapidapi. 
   Для получения ключа для этого сервиса вам необходимо зарегистрироваться на этом ресурсе и найти этот АПИ:
      https://rapidapi.com/apidojo/api/hotels4
   
   После получения базовой бесплатной подписки на данный АПИ вы получите ключ, который тоже нужно вставить в файл .env
   
   Если по каким-то причинам регистрация на этом ресурсе невозможна или базовая подписка стала платной - вы можете воспользоваться 
   моим личным кодом для hotels АПИ: [hotels АПИ](3307e983ccmsh2637827a7c96874p1182ccjsnbe958bac52d9)
   
   Пожалуйста, используйте его только в ознакомительных целях.
   
4. **Запуск бота**

   В корневой директории необходимо выполнить эту команду:
   
   ```bash
   python main.py
   ```

   После успешного запуска бота вы должны увидеть эти сообщения в логе:
   
   ```
   INFO:root:Добавление кастомных фильтров...
   INFO:root:Установка стандартных команд бота...
   INFO:root:Запуск бота в режиме бесконечного опроса...
   ```

## Команды бота

- /start - запуск бота, выполняется автоматически при подключении к боту.
- /help - список команд и их описание.
- /lowprice — вывод самых дешёвых отелей в городе;
- /highquality — вывод отелей самого высокого класса;
- /customfilters — вывод отелей с указанием дополнительных параметров поиска;
- /history — вывод истории поиска отелей.

### Описание команд телеграм-бота

#### Команда (/lowprice)

1. При запуске команды /lowprice бот запрашивает город, в котором необходимо найти отели.
2. После ввода пользователем названия города бот выполняет запрос к API Hotels и проводит поиск по городам, после чего 
   предлагает пользователю уточнить локацию поиска, если городов с таким названием несколько. Если город с таким названием
   не найден - бот предлагает ввести название города ещё раз, возможно была допущена ошибка в названии.
3. Далее бот запрашивает у пользователя количество отелей, которое необходимо вывести. В каждом запросе может быть 
   не более 10 отелей.
4. После этого бот спрашивает у пользователя, требуются ли фотографии отеля. Если пользователь отвечает утвердительно,
   то бот предлагает ввести количество фотографий отеля, но не более 5 штук. Если пользователь ввел количество больше 5,
   то бот сообщит пользователю об этом и сообщит, что фотографий будет 5 штук.
5. Далее бот запрашивает у пользователя даты прибытия и отбытия с помощью календаря-клавиатуры.
6. Для данной команды на этом этапе бот переходит к подбору подходящих отелей и по результатам запроса к API Hotels 
   отправляет пользователю сообщения с информацией о каждом найденном отеле и его фотографии, если требуется.

#### Команда (/highquality)

1. При запуске команды /highquality бот запрашивает город, в котором необходимо найти отели.
2. После ввода пользователем названия города бот выполняет запрос к API Hotels и проводит поиск по городам, после чего 
   предлагает пользователю уточнить локацию поиска, если городов с таким названием несколько. Если город с таким названием
   не найден - бот предлагает ввести название города ещё раз, возможно была допущена ошибка в названии.
3. Далее бот запрашивает у пользователя количество отелей, которое необходимо вывести. В каждом запросе может быть 
   не более 10 отелей.
4. После этого бот спрашивает у пользователя, требуются ли фотографии отеля. Если пользователь отвечает утвердительно,
   то бот предлагает ввести количество фотографий отеля, но не более 5 штук. Если пользователь ввел количество больше 5,
   то бот сообщит пользователю об этом и сообщит, что фотографий будет 5 штук.
5. Далее бот запрашивает у пользователя даты прибытия и отбытия с помощью календаря-клавиатуры.
6. Для данной команды на этом этапе бот переходит к подбору подходящих отелей и по результатам запроса к API Hotels 
   отправляет пользователю сообщения с информацией о каждом найденном отеле и его фотографии, если требуется.

#### Команда (/customfilters)

1. При запуске команды /highquality бот запрашивает город, в котором необходимо найти отели.
2. После ввода пользователем названия города бот выполняет запрос к API Hotels и проводит поиск по городам, после чего 
   предлагает пользователю уточнить локацию поиска, если городов с таким названием несколько. Если город с таким названием
   не найден - бот предлагает ввести название города ещё раз, возможно была допущена ошибка в названии.
3. Далее бот запрашивает у пользователя количество отелей, которое необходимо вывести. В каждом запросе может быть 
   не более 10 отелей.
4. После этого бот спрашивает у пользователя, требуются ли фотографии отеля. Если пользователь отвечает утвердительно,
   то бот предлагает ввести количество фотографий отеля, но не более 5 штук. Если пользователь ввел количество больше 5,
   то бот сообщит пользователю об этом и сообщит, что фотографий будет 5 штук.
5. Далее бот запрашивает у пользователя даты прибытия и отбытия с помощью календаря-клавиатуры.
6. Далее бот переходит к запросу дополнительных параметров поиска. Первый такой параметр - это способ сортировки полученных
   результатов, пользователю будет предложено выбрать один из них.
7. Следующий параметр поиска - ценовой диапазон для отелей. Пользователь должен ввести две цены через дефис, где первая
   и вторая цена - минимальная и максимальная цена за ночь проживания.
8. Далее бот просит пользователя указать, какой должен быть рейтинг посетителей у отелей.
9. Последний параметр поиска - это количество звезд у отелей.
10. После выбора всех дополнительных параметров переходит к подбору подходящих отелей и по результатам запроса к API Hotels 
   отправляет пользователю сообщения с информацией о каждом найденном отеле и его фотографии, если требуется.

#### Команда (/history)

1. После запуска команды /history бот проверяет, проводил ли данный пользователь поиск отелей с использованием бота. 
   Если пользователь уже искал отели - бот сообщает пользователю сколько его поисковых запросов хранятся в базе данных
   и выводит последние 10 результатов поиска (если запросов было меньше 10 - выводит все).
2. Вывод результатов происходит в виде сообщения с параметрами поиска, где указывается следующие параметры
   - дата поиска
   - тип поиска
   - город
   - количество отелей
   - количество фотографий
   - даты поездки
   - если был выбран поиск с указанием дополнительных параметров - то они так же указываются.
3. К каждому сообщению добавляется кнопка "Показать результаты поиска". При нажатии на эту кнопку пользователю будут 
   повторно отправлены все сообщения с найденными отелями, как если бы он проводил поиск заново.